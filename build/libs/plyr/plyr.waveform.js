!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).DetectBPM=t()}}((function(){return function t(e,i,n){function o(a,s){if(!i[a]){if(!e[a]){var h="function"==typeof require&&require;if(!s&&h)return h(a,!0);if(r)return r(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var d=i[a]={exports:{}};e[a][0].call(d.exports,(function(t){return o(e[a][1][t]||t)}),d,d.exports,t,e,i,n)}return i[a].exports}for(var r="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t){var e=function(t){var e=t.length,i=t.numberOfChannels,o=t.sampleRate,r=new n(i,e,o),a=r.createBufferSource();a.buffer=t;var s=r.createBiquadFilter();return s.type="lowpass",a.connect(s),s.connect(r.destination),a}(t);return e.start(0),[r,s,h(t.sampleRate),o].reduce((function(t,e){return e(t)}),e.buffer.getChannelData(0))};var n=window.OfflineAudioContext||window.webkitOfflineAudioContext;function o(t){return t.sort((function(t,e){return e.count-t.count})).splice(0,5)[0].tempo}function r(t){for(var e=[],i=.9;e.length<15&&i>=.01;)e=a(t,i),i-=.005;if(e.length<15)throw new Error("Could not find enough samples for a reliable detection.");return e}function a(t,e){for(var i=[],n=0,o=t.length;n<o;n+=1)t[n]>e&&(i.push(n),n+=100);return i}function s(t){var e=[];return t.forEach((function(i,n){for(var o=function(o){var r=t[n+o]-i;e.some((function(t){if(t.interval===r)return t.count+=1}))||e.push({interval:r,count:1})},r=0;r<10;r+=1)o(r)})),e}function h(t){return function(e){var i=[];return e.forEach((function(e){if(0!==e.interval){for(var n=60/(e.interval/t);n<90;)n*=2;for(;n>180;)n/=2;n=Math.round(n),i.some((function(t){if(t.tempo===n)return t.count+=e.count}))||i.push({tempo:n,count:e.count})}})),i}}},{}],2:[function(t,e,i){e.exports=t("./detect").default},{"./detect":1}]},{},[2])(2)})),window.Waveform={},function(t){"use strict";Waveform=function(t){this.data=[],this.peaks=[],this.wrap=null,this.progress=null,this.wave=null,this.waveme=null,this.percent=0,this.options=this._extends({},this._options,t),"string"==typeof this.options.duration&&this.options.duration.indexOf(":")>-1&&(this.options.duration=this.timeToMS(this.options.duration)),this.init()},Waveform.prototype={_options:{id:Math.random().toString(32).substring(2),rtl:"rtl"==getComputedStyle(document.body).direction,barSpacing:1,barWidth:2,barHeight:50,padding:20,barRadius:0,waveLength:180,sampleLength:1800,color:"rgba(160,160,160,0.4)",progressColor:!1,cursorColor:"currentColor",width:300,height:40,duration:0,align:"bottom"},_extends:function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},init:function(){var e=this;e.container="string"==typeof e.options.container?document.querySelector(e.options.container):e.options.container,e.container&&(e.wrap=t('<div class="waveform_wrap" data-id="'+e.options.id+'" style="position:relative;"></div>'),e.wrap.css("height",e.options.height+"px"),e.progress=t('<div class="waveform_progress" style="position:absolute;width:0;height:100%;overflow:hidden;border-right:0.5px solid transparent">'),e.wave=e.createWave(),e.wrap.append(e.wave).appendTo(e.container),e.waveme=e.createWave(),e.progress.append(e.waveme).appendTo(e.wrap),e.wrap.append('<span class="waveform-time" style="position:absolute;height:100%;width:100%;display:flex;align-items:'+e.getAlign()+'"><span class="waveform-elapsed"></span><span class="waveform-duration"></span></span>'),e.wrap.find(".waveform-duration").html(e.msToTime(e.options.duration)),e.initEvents())},createWave:function(){var t=document.createElement("canvas");return t.style.position="absolute",t.style.height="100%",t.width=2*this.options.width,t.height=2*this.options.height,t},clearWave:function(){var t=this.wave.getContext("2d");t.clearRect(0,0,t.canvas.width,t.canvas.height);var e=this.waveme.getContext("2d");e.clearRect(0,0,e.canvas.width,e.canvas.height)},drawWave:function(){if(0!=this.data.length&&this.container){this.options.width=parseInt(this.wrap.width()),this.wave.width=this.waveme.width=2*this.options.width,this.wave.style.width=this.waveme.style.width=this.options.width+"px",this.clearWave(),this.prepareData();var e=this.options.progressColor?this.options.progressColor:t(this.container).css("borderTopColor");this.draw(this.wave.getContext("2d")),this.draw(this.waveme.getContext("2d"),e)}},draw:function(t,e,i){var n=this.peaks,o=n.length,r=this.wave.height,a=Math.round(o*(i||1)),s=0,h=0,u=0,d=2*this.options.barWidth;t.fillStyle=e||this.options.color;for(var p=0;p<a;p++){switch(s=p*(2*this.options.barSpacing+d),this.options.rtl&&(s=2*this.options.width-s),u=n[p],this.options.align){case"top":h=0;break;case"middle":h=Math.ceil((r-n[p])/2);break;case"center":t.setTransform(1,0,0,1,this.wave.width/2,this.wave.height/2),t.rotate(2*p*Math.PI/o-Math.PI/2),t.translate(0,(this.wave.height-2*this.options.barHeight)/2),s=-this.options.barWidth/2,h=0;break;default:h=r-n[p]}t.save(),this.options.barRadius>0?this.drawRoundRect(t,s,h,d,u,this.options.barRadius):t.fillRect(s,h,d,u),t.restore()}},drawRoundRect:function(t,e,i,n,o,r){0!==o&&(t.beginPath(),t.moveTo(e+r,i),t.lineTo(e+n-r,i),t.quadraticCurveTo(e+n,i,e+n,i+r),t.lineTo(e+n,i+o-r),t.quadraticCurveTo(e+n,i+o,e+n-r,i+o),t.lineTo(e+r.bl,i+o),t.quadraticCurveTo(e,i+o,e,i+o-r),t.lineTo(e,i+r),t.quadraticCurveTo(e,i,e+r,i),t.closePath(),t.fill())},prepareData:function(){var t=this.options.width,e=2*this.options.height-this.options.padding;"center"==this.options.align&&(t=(this.options.height-2*this.options.barHeight)*Math.PI,e=this.options.barHeight);var i=Math.max.apply(null,this.data)/e;this.peaks=this.data.map((function(t){return Math.round((0==t?.5:t)/i)}));var n=Math.round(t/(this.options.barWidth+this.options.barSpacing));this.peaks=this.resizeData(this.peaks,n)},resizeData:function(t,e){var i=t.length-e,n=(t.length-1)/e,o=[],r=0,a=0;if(0==i)return t;for(var s=0;s<e;s++)if(r=Math.round(s*n),i<0)a=a==r?0:r,o[s]=a>0?o[s-1]+Math.round((t[r]-t[r-1])*n):t[r];else{for(var h=0,u=0;u<Math.round(n);u++){var d=t[r+u];d>h&&(h=d)}o[s]=h}return o},initEvents:function(){var e,i=this;window.addEventListener("resize",(function(){clearTimeout(e),e=setTimeout((function(){i.options.width=i.wrap.width(),i.drawWave()}),500)})),this.wrap.on("click",(function(t){var e=i.getPercent(t);i.wrap.trigger("update",[e,i.options.id])})),this.wrap.on("timeupdate",(function(t,e,n){i.update(e,n)})),t(document).trigger("waveform:ready",[this])},update:function(t,e){var i=this,n=.5;i.updateTime(t),i.progress.css("width",100*t+"%"),i.progress.css("border-right-color",0==t?"transparent":i.options.cursorColor),(Math.abs(t-i.percent)>.02||0==t||e)&&(n=.1),t>.99&&(n=.2),1==t&&setTimeout((function(){i.update(0)}),200),i.progress.css("transition","width "+n+"s linear"),i.percent=t},drawTime:function(){this.wrap.find(".waveform-duration").html(this.msToTime(this.options.duration)),this.updateTime(0)},updateTime:function(t){var e=this.options.duration*t,i=this.msToTime(e);this.wrap.find(".waveform-elapsed").html(i)},load:function(e){var i=this;i.container&&t(i.container).parent().removeClass("loaded"),"string"!=typeof e?(i.data=e,setTimeout((function(){i.drawWave()}),100),i.drawTime(),i.container&&t(i.container).parent().addClass("loaded")):this.loadAudioData(e)},loadAudioData:function(t,e){var i=this,n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){(new(window.AudioContext||window.webkitAudioContext)).decodeAudioData(n.response,(function(t){i.options.duration=1e3*t.duration,i.data=t.data=i.parsePeaks(t);try{t.bpm=DetectBPM(t)}catch(t){}i.container&&i.load(i.data),e&&e(t)}))},n.send()},parsePeaks:function(t){for(var e=this.options.sampleLength,i=t.length/e,n=~~(i/10)||1,o=t.numberOfChannels,r=[],a=!0,s=0;s<o;s++)for(var h=t.getChannelData(s),u=0;u<e;u++){for(var d=~~(u*i),p=~~(d+i),c=0,l=d;l<p;l+=n){var f=Math.abs(h[l]);f>c&&(c=f)}(0==s||c>r[u])&&(r[u]=Math.round(100*c),c>0&&(a=!1))}return a?[]:this.resizeData(r,this.options.waveLength)},msToTime:function(t,e){if(""==t&&0!=t)return"";var i=parseInt(t%1e3),n=parseInt(t/1e3%60),o=parseInt(t/6e4%60),r=parseInt(t/36e5%24);n=n<10?"0"+n:n,o=o<10?"0"+o:o;var a="";return e&&(a=":"+(i<10?"00"+i:i<100?"0"+i:i)),""!=r?(r=r<10?"0"+r:r)+":"+o+":"+n+a:o+":"+n+a},timeToMS:function(t){var e=t.match(/[0-9]+[HMS]/g);if(e){var i=0;return e.forEach((function(t){var e=t.charAt(t.length-1),n=parseInt(t.slice(0,-1));switch(e){case"H":i+=60*n*60;break;case"M":i+=60*n;break;case"S":i+=n}})),1e3*i}var n=t.split(":");return 1==n.length?1e3*Number(n[0]):2==n.length?60*Number(n[0])*1e3+1e3*Number(n[1]):60*Number(n[0])*60*1e3+60*Number(n[1])*1e3+1e3*Number(n[2])},getAlign:function(){var t="flex-end";switch(this.options.align){case"top":t="flex-start";break;case"middle":t="center"}return t},getPercent:function(t){var e=this,i=0,n=e.wrap[0].getBoundingClientRect(),o=t.targetTouches?t.targetTouches[0].clientX:t.clientX,r=o-n.left;if(e.options.rtl&&(r=e.options.width-r),i=(r/e.options.width).toFixed(6),"center"==e.options.align){var a=(t.targetTouches?t.targetTouches[0].clientY:t.clientY)-n.top,s=o-n.left,h=a-e.options.height/4,u=s-e.options.width/2,d=Math.atan2(h,u);(d*=180/Math.PI)<0&&(d=360+d),i=(d/360).toFixed(6)}return i<0&&(i=0),i>1&&(i=1),i}}}(jQuery);